import{f as h,c as O,a as _,r as a,j as o,A as F,N as H,b as V,d as k,T as K,I as z,e as M,g as G,B as L,h as J,C as W,u as $,i as R,F as Y,k as U,s as Q,l as X,m as Z}from"./vendor-CAtmAK9e.js";async function ee(){try{return await h("/api/user/validate.json")}catch{return{valid:!1,loaded:new Date().toISOString()}}}const te={valid:!1,user:null,roles:[],loading:!1,loaded:null,error:null},pe=t=>t.user.valid,re=t=>t.user.loading,Ce=t=>t.user.error,se=t=>t.user.roles.includes("barcode_edit")||t.user.roles.includes("root"),he=t=>t.user.roles.includes("product-admin")||t.user.roles.includes("root"),T=O("user/validate",async()=>{const t=await ee();return t&&(t.loaded=new Date().toISOString()),t},{condition(t,{getState:e}){return!re(e())}}),ge=_(te,t=>{t.addCase(T.pending,e=>{e.loading=!0,e.error=null}).addCase(T.fulfilled,(e,r)=>{e.loading=!1,e.valid=r.payload?.valid??!1,e.user=r.payload?.profile?.user??null,e.roles=r.payload?.profile?.roles??[],e.loaded=r.payload?.loaded??null,e.error=null}).addCase(T.rejected,(e,r)=>{e.loading=!1,e.valid=!1,e.user=null,e.roles=[],e.error=r.error.message??null})});async function Ie(t){try{const e="/api/operations/production/item/info/chums/:itemCode".replace(":itemCode",encodeURIComponent(t));return(await h(e,{cache:"default"}))?.item??null}catch(e){return e instanceof Error?(console.debug("loadItemInfo()",e.message),Promise.reject(e)):(console.debug("loadItemInfo()",e),Promise.reject(new Error("Error in loadItemInfo()")))}}async function oe(t){try{const e=new URLSearchParams;e.set("search",t);const r=`/api/search/item.json?${e.toString()}`;return(await h(r))?.result??[]}catch(e){return e instanceof Error?(console.debug("fetchItemLookup()",e.message),Promise.reject(e)):(console.debug("fetchItemLookup()",e),Promise.reject(new Error("Error in fetchItemLookup()")))}}const P=t=>[t.ARDivisionNo,t.CustomerNo].filter(e=>!!e).join("-"),ne=t=>t.ItemCode,je={AltItemCode:"reqAltItemNumber",Color:"reqColor",Custom1:"reqCustom1",Custom2:"reqCustom2",Custom3:"reqCustom3",Custom4:"reqCustom4",CustomerPart:"reqCustomerPart",ItemDescription:"reqItemDescription",MSRP:"reqMSRP",SKU:"reqSKU",UPC:"reqUPC"};async function we(){try{const e=await h("/api/operations/barcodes/customers.json"),r={};return e?.result?.forEach(s=>{r[P(s)]=s}),r}catch(t){return t instanceof Error?(console.debug("loadCustomers()",t.message),Promise.reject(t)):(console.debug("loadCustomers()",t),Promise.reject(new Error("Error in loadCustomers()")))}}async function xe(t){try{if(!t)return{settings:null};const[e,r]=await Promise.all([ae(t),ce(t)]);return{settings:e,items:r}}catch(e){return e instanceof Error?(console.debug("fetchCustomer()",e.message),Promise.reject(e)):(console.debug("fetchCustomer()",e),Promise.reject(new Error("Error in fetchCustomer()")))}}async function ae(t){try{const e="/api/operations/barcodes/customers/:id.json".replace(":id",encodeURIComponent(t)),r=await h(e),[s]=r?.result??[];return s&&(s.reqAltItemNumber=!!s.reqAltItemNumber,s.reqItemDescription=!!s.reqItemDescription,s.reqColor=!!s.reqColor,s.reqSKU=!!s.reqSKU,s.reqCustomerPart=!!s.reqCustomerPart,s.reqUPC=!!s.reqUPC,s.reqMSRP=!!s.reqMSRP,s.reqCustom1=!!s.reqCustom1,s.reqCustom2=!!s.reqCustom2,s.reqCustom3=!!s.reqCustom3,s.reqCustom4=!!s.reqCustom4),s??null}catch(e){return e instanceof Error?(console.debug("loadCustomer()",e.message),Promise.reject(e)):(console.debug("loadCustomer()",e),Promise.reject(new Error("Error in loadCustomer()")))}}async function Ee(t){try{const e=t.id?"/api/operations/barcodes/customers/:id.json".replace(":id",encodeURIComponent(t.id)):"/api/operations/barcodes/customers.json",r=JSON.stringify(t),s=t.id?"PUT":"POST",l=await h(e,{method:s,body:r}),[i]=l?.result??[];return i??null}catch(e){return e instanceof Error?(console.debug("postCustomerSettings()",e.message),Promise.reject(e)):(console.debug("postCustomerSettings()",e),Promise.reject(new Error("Error in postCustomerSettings()")))}}const A=t=>{const e={};return t.forEach(r=>{e[ne(r)]=r}),e};async function ce(t){try{const e="/api/operations/barcodes/customers/:customer_id/items.json".replace(":customer_id",encodeURIComponent(t)),r=await h(e);return A(r?.result??[])}catch(e){return e instanceof Error?(console.debug("loadCustomer()",e.message),Promise.reject(e)):(console.debug("loadCustomer()",e),Promise.reject(new Error("Error in loadCustomer()")))}}async function Pe(t){try{if(!t.CustomerID)return Promise.reject(new Error("Item is missing customerId"));const e=(t.ID?"/api/operations/barcodes/customers/:customer_id/items/:item_id.json":"/api/operations/barcodes/customers/:customer_id/items.json").replace(":customer_id",encodeURIComponent(t.CustomerID)).replace(":item_id",encodeURIComponent(t.ID??0)),r=t.ID?"PUT":"POST",s=JSON.stringify({...t,ItemDescription:t.ItemDescription.trim()}),l=await h(e,{method:r,body:s});return A(l?.result??[])}catch(e){return e instanceof Error?(console.debug("loadCustomer()",e.message),Promise.reject(e)):(console.debug("loadCustomer()",e),Promise.reject(new Error("Error in loadCustomer()")))}}async function ye(t){try{if(!t.CustomerID||!t.ID)return Promise.reject(new Error("Item is missing customerId or itemId"));const e="/api/operations/barcodes/customers/:customer_id/items/:item_id.json".replace(":customer_id",encodeURIComponent(t.CustomerID)).replace(":item_id",encodeURIComponent(t.ID)),r=await h(e,{method:"DELETE"});return A(r?.result??[])}catch(e){return e instanceof Error?(console.debug("deleteCustomerItem()",e.message),Promise.reject(e)):(console.debug("deleteCustomerItem()",e),Promise.reject(new Error("Error in deleteCustomerItem()")))}}async function ie(t){try{if(t==="")return[];const e=new URLSearchParams;e.set("search",t);const r=`/api/search/customer.json?${e.toString()}`;return(await h(r))?.result??[]}catch(e){return e instanceof Error?(console.debug("getCustomerLookup()",e.message),Promise.reject(e)):(console.debug("getCustomerLookup()",e),Promise.reject(new Error("Error in getCustomerLookup()")))}}async function be(t,e){try{const r=await h("/api/operations/sku/by-color/next",{cache:"no-cache"});return(await h("/api/operations/sku/by-color",{method:"POST",body:JSON.stringify({company:"chums",ItemCode:t.customItemCode??t.ItemCode,upc:r?.nextUPC,notes:e})}))?.colorUPC??null}catch(r){return r instanceof Error?(console.debug("postGenNextUPC()",r.message),Promise.reject(r)):(console.debug("postGenNextUPC()",r),Promise.reject(new Error("Error in postGenNextUPC()")))}}class Se extends a.Component{state={hasError:!1,componentStack:"",message:""};constructor(e){super(e)}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,r){this.setState({componentStack:r.componentStack,message:e.message})}render(){const{hasError:e,componentStack:r,message:s}=this.state;return e?o.jsxs(o.Fragment,{children:[o.jsx("h1",{children:"Sorry! something went wrong!"}),o.jsx(F,{variant:"warning",children:s}),o.jsx("code",{className:"pre",children:o.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:r})})]}):this.props.children}}const Ne=({id:t,to:e,icon:r,className:s,canClose:l,disabled:i,onClose:p,children:d})=>{const y=()=>{p&&p(t)};return o.jsx(H,{children:o.jsxs(V,{className:k("nav-link",s,{disabled:i}),tabIndex:i?-1:0,to:e,children:[!!r&&o.jsx("span",{className:k("nav-item-icon me-1",r)}),o.jsx("span",{className:"nav-item-text",children:d}),l&&o.jsx("span",{"aria-label":"Close",onClick:y,className:"ms-2 bi-x-lg"})]})})},De=({note:t})=>t?o.jsx(K,{title:t,children:o.jsx(z,{color:"info",size:"small",sx:{color:"white",backgroundColor:"info.main"},children:o.jsx(M,{})})}):null,qe=({customer:t,onChange:e,onSelectCustomer:r,children:s,...l})=>{const[i,p]=a.useState(t),[d,y]=a.useState(null),[I,j]=a.useState(""),[b,E]=a.useState(!1),[w,S]=a.useState([]),[g,u]=a.useState(!1),[C,x]=a.useState(0);a.useEffect(()=>{p(t),t&&N(P(t)).catch(c=>console.debug("loadCustomerSearch()",c.message))},[t]),a.useEffect(()=>()=>{window.clearTimeout(C)},[]),a.useEffect(()=>{if(I.length<2)return;window.clearTimeout(C);const c=window.setTimeout(()=>N(I),350);x(c)},[I]);const N=async c=>{if(!g){u(!0);try{const n=await ie(c);S(n);const[f]=n.filter(D=>D.CustomerName.startsWith(c)||P(D).startsWith(c));y(f??null),u(!1)}catch(n){u(!1),n instanceof Error&&console.debug("loadCustomerSearch()",n.message)}}};return o.jsx(G,{open:b,onOpen:()=>E(!0),size:"small",onClose:()=>E(!1),loading:g,isOptionEqualToValue:(c,n)=>!!n&&P(c)===P(n),value:i,onKeyDown:c=>{c.key==="Tab"&&d&&(j(P(d)),r(d))},onChange:(c,n)=>{p(n),r(n)},onInputChange:(c,n)=>{j(n)},filterOptions:c=>c,getOptionLabel:c=>typeof c=="string"?c:P(c),renderInput:c=>o.jsx(J,{...c,variant:"filled",sx:{width:"25rem"},label:"Customer No",InputProps:{...l,...c.InputProps,endAdornment:o.jsxs(o.Fragment,{children:[g?o.jsx(W,{color:"inherit",size:"20"}):null,c.InputProps.endAdornment]})}}),renderOption:(c,n)=>o.jsxs(L,{component:"li",...c,style:{display:"flex",justifyContent:"space-between",width:"100%",flexShrink:0},children:[o.jsx(L,{children:o.jsx("strong",{children:P(n)})}),o.jsx(L,{sx:{ml:2},children:n.CustomerName})]}),options:w})},Ue=({name:t,required:e,onChangeRequired:r,value:s,onChangeValue:l})=>{const i=$(se),p=a.useId();return o.jsxs(R,{size:"sm",children:[o.jsx(R.Text,{children:t}),o.jsx(R.Checkbox,{id:p,"aria-label":t,readOnly:!i,checked:e,onChange:d=>r(d.target.checked)}),o.jsx(Y,{type:"text",size:"sm",disabled:!i,readOnly:!e,placeholder:t,value:s,onChange:l})]})},ke=({inactiveItem:t,productType:e,productStatus:r})=>e==="D"?o.jsx(U,{color:"dark",children:"Disco"}):t==="Y"?o.jsx(U,{color:"danger",children:"Inactive"}):o.jsxs(o.Fragment,{children:[!!r&&o.jsx(U,{bg:"warning",text:"dark",children:r}),!e&&o.jsx(U,{bg:"info",children:"Custom"})]}),ue=(t,e)=>{const r=a.useRef(e);a.useEffect(()=>{r.current=e},[e]),a.useEffect(()=>{const s=l=>{t.current&&!t.current.contains(l.target)&&r.current()};return window.addEventListener("mousedown",s),window.addEventListener("touchstart",s),window.addEventListener("focusin",s),()=>{window.removeEventListener("mousedown",s),window.removeEventListener("touchstart",s),window.removeEventListener("focusin",s)}},[t])},le=Q.ul`
    --bs-list-group-item-padding-y: 0.25rem;
    font-size: 0.85rem;
`;function me({containerRef:t,value:e,data:r,onChange:s,onChangeRecord:l,renderItem:i,itemKey:p,helpText:d,itemStyle:y,filter:I,readOnly:j,disabled:b,...E}){const[w,S]=a.useState(r.slice(0,50)),[g,u]=a.useState(!1),[C,x]=a.useState(-1),[N]=a.useState("100px"),{refs:c,floatingStyles:n}=X({placement:"bottom-end"});ue(t,()=>u(!1)),a.useEffect(()=>{const m=r.filter(I(e));S(m),x(e===""?-1:0)},[e]),a.useEffect(()=>{S(r.filter(I(e)))},[r]),a.useEffect(()=>{t.current?.querySelector("li.list-group-item.active")?.scrollIntoView(!1)},[C]);const f=m=>{if(j||b)return;const q=w.length;switch(m.key){case"Escape":u(!1),m.preventDefault(),m.stopPropagation();return;case"ArrowDown":m.preventDefault(),u(!0),x((C+1)%q);return;case"ArrowUp":m.preventDefault(),u(!0),x((C-1+q)%q);return;case"PageDown":m.preventDefault(),u(!0),x(Math.min(C+10,q-1));return;case"PageUp":m.preventDefault(),u(!0),x(Math.max(C-10,0));return;case"Enter":case"Tab":const B=w[C];return g?(m.preventDefault(),u(!1),l(B)):void 0}g||u(!0)},D=m=>{l(m),u(!1)},v=()=>{j||b||!w.length||u(!0)};return o.jsxs(o.Fragment,{children:[o.jsx("input",{type:"search",autoComplete:"off",readOnly:j,disabled:b,className:"form-control form-control-sm",value:e,onChange:s,onKeyDown:f,ref:c.setReference,onFocus:v,onBlur:()=>u(!1),...E}),o.jsx("small",{className:"text-muted overflow-hidden",children:d??null}),g&&o.jsx("div",{ref:c.setFloating,style:{height:"auto",width:"max-content",minWidth:N,maxHeight:"75vh",overflow:"auto",zIndex:1e3,...n},children:o.jsx(le,{className:k("list-group fade",{show:g}),children:w.map((m,q)=>o.jsx("li",{className:k("list-group-item",{active:C===q}),style:y,onClick:()=>D(m),children:i(m)},p(m)))})})]})}const de=me,ve=({itemCode:t,onChange:e,onSelectItem:r,children:s,...l})=>{const[i,p]=a.useState(t),[d,y]=Z(t,350),[I,j]=a.useState([]),[b,E]=a.useState(!1),[w,S]=a.useState(0),g=a.useRef(null);a.useEffect(()=>{p(d);const[n]=I.filter(f=>f.ItemCode===d);r(n||null),u(d)},[d]),a.useEffect(()=>()=>{window.clearTimeout(w)},[]),a.useEffect(()=>{y(i)},[i]);const u=n=>{b||(E(!0),oe(n).then(f=>{j(f),E(!1);const[D]=f.filter(v=>v.ItemCode===n);r(D||null)}).catch(f=>{E(!1),f instanceof Error&&console.log(f.message)}))};a.useEffect(()=>{if(i.length<2){j([]);return}window.clearTimeout(w);const n=window.setTimeout(()=>u(i),350);S(n)},[i]);const C=n=>{p(n.target.value),e(n)},x=n=>{p(n?.ItemCode??""),r(n)},N=n=>f=>f.ItemCode.startsWith(n)||f.ItemCodeDesc.toLowerCase().includes(n.toLowerCase()),c=n=>o.jsxs("div",{children:[o.jsx("strong",{className:"me-3",children:n.ItemCode})," ",n.ItemCodeDesc]});return o.jsxs("div",{className:"input-group input-group-sm",ref:g,children:[o.jsx("span",{className:"input-group-text",children:o.jsx("span",{className:"bi-search"})}),o.jsx(de,{containerRef:g,...l,value:i,data:I,onChange:C,onChangeRecord:x,renderItem:c,itemKey:n=>n.ItemCode,filter:N}),s]})};export{qe as C,Se as E,ve as I,Ne as N,xe as a,Pe as b,P as c,be as d,ye as e,Ie as f,we as g,re as h,Ce as i,se as j,De as k,T as l,Ue as m,ke as n,je as o,Ee as p,he as q,pe as s,ge as u};
//# sourceMappingURL=components-Nv-AO_nR.js.map
